# =============================================================================
# LeForge Embedded Mosquitto MQTT Broker Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# General Settings
# -----------------------------------------------------------------------------
# PID file location (requires writable directory)
pid_file /var/run/mosquitto/mosquitto.pid

# Persistence
persistence true
persistence_location /var/lib/mosquitto/

# Logging
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# -----------------------------------------------------------------------------
# TCP Listener (for internal/plugin communication)
# -----------------------------------------------------------------------------
listener 1883 0.0.0.0
protocol mqtt

# Allow anonymous connections (secured at network level via Docker)
# For production with external access, enable authentication
allow_anonymous true

# -----------------------------------------------------------------------------
# WebSocket Listener (for browser clients)
# -----------------------------------------------------------------------------
listener 9001 0.0.0.0
protocol websockets

# -----------------------------------------------------------------------------
# Message Settings
# -----------------------------------------------------------------------------
# Maximum packet size (256KB - suitable for most IoT/event data)
max_packet_size 262144

# Maximum inflight messages
max_inflight_messages 20
max_inflight_bytes 0

# Maximum queued messages per client
max_queued_messages 1000
max_queued_bytes 0

# Keep alive interval
max_keepalive 65535

# -----------------------------------------------------------------------------
# Client Settings  
# -----------------------------------------------------------------------------
# Auto-expire persistent clients after 7 days of inactivity
persistent_client_expiration 7d

# Allow zero-length client IDs (will be auto-assigned)
allow_zero_length_clientid true
auto_id_prefix leforge-

# -----------------------------------------------------------------------------
# Retained Messages
# -----------------------------------------------------------------------------
# Enable retained messages (useful for last-known-good values)
retain_available true

# -----------------------------------------------------------------------------
# System Topic
# -----------------------------------------------------------------------------
# Publish broker statistics to $SYS topic hierarchy
sys_interval 10

# -----------------------------------------------------------------------------
# Security Notes (for future enhancement)
# -----------------------------------------------------------------------------
# To enable authentication, uncomment and configure:
# password_file /etc/mosquitto/passwd
# acl_file /etc/mosquitto/acl
#
# To enable TLS:
# listener 8883
# cafile /etc/mosquitto/certs/ca.crt
# certfile /etc/mosquitto/certs/server.crt
# keyfile /etc/mosquitto/certs/server.key
# require_certificate false
